var ee=Object.defineProperty;var te=(d,e,t)=>e in d?ee(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var F=(d,e,t)=>(te(d,typeof e!="symbol"?e+"":e,t),t);import{j as y,F as w,a as c,H as V,S as H,b as _,c as U,_ as re,r as f,D as $,g as q,N as ne,B as C,p as se,e as oe,l as v,f as W,u as K,d as X,h as ae,i as de,k as j,T as ie,m as ce,n as le,o as Y,q as J,s as ue,t as Q,R as he,v as fe,C as pe}from"./vendor.d5820c35.js";const ge=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};ge();const me=["Dominator","LiveOut"],xe=["Default","Reversed","PostOrder","Reverse Post-Order","Reverse Post-Order on Reverse CFG"],ve=d=>y(w,{as:"nav",width:"100%",padding:6,bgColor:"green.50",children:[y(w,{align:"center",mr:5,children:[c(V,{as:"h1",size:"lg",letterSpacing:"tighter",mr:5,children:"DFAV"}),c(V,{as:"h2",size:"md",letterSpacing:"tighter",color:"gray.600",children:"Data-Flow Analysis Visualizer"})]}),c(H,{}),c(w,{align:"center",mr:2,children:c(_,{bgColor:"white",value:d.order,onChange:e=>d.onOrderChange(e.currentTarget.value),placeholder:"Select Order",children:xe.map(e=>c("option",{value:e,children:e},e))})}),c(w,{align:"center",children:c(_,{bgColor:"white",value:d.mode,onChange:e=>d.onModeChange(e.currentTarget.value),placeholder:"Select Analysis",children:me.map(e=>c("option",{value:e,children:e},e))})})]});U.exports.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@1.4.3/src-noconflict/");U.exports.config.setModuleUrl("ace/mode/javascript_worker","https://cdn.jsdelivr.net/npm/ace-builds@1.4.3/src-noconflict/worker-javascript.js");const ye=({value:d,onChange:e})=>c(re,{value:d,mode:"javascript",theme:"tomorrow",onChange:e,name:"UNIQUE_ID_OF_DIV",editorProps:{$blockScrolling:!0},width:"100%",height:"100%",setOptions:{fontSize:"18px",enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,useWorker:!1}});function we(d){const e=f.exports.useRef(null),t=f.exports.useRef();return f.exports.useEffect(()=>{if(d.graph.nodes.size===0)return;const n=Array.from(d.graph.nodes.values()),s=new $(n.map(r=>({id:r.data.id,label:(()=>{var l;let o=`${r.data.index}: `;switch(r.data.type){case"entry":o+="Entry";break;case"exit":o+="Exit";break;default:{try{r.data.astNode.type==="SwitchCase"?r.data.astNode.test?o+="switch-case "+q(r.data.astNode.test):o+="switch-case default":o+=q(r.data.astNode)}catch{}break}}const a=(l=d.set)==null?void 0:l.get(r.data.id);return a&&(o+=`
`+a),o})()}))),i=new $(n.map(r=>r.adjacent.map(([o,a])=>({from:r.data.id,to:o.data.id,label:a}))).flat());e.current&&(t.current=new ne(e.current,{nodes:s,edges:i},{physics:{enabled:!1},edges:{arrows:{to:{enabled:!0}}},nodes:{shape:"box",chosen:{node:(r,o,a,l)=>{r.color="#F4FFF4",r.size=100},label:(r,o,a,l)=>{r.size=16,r.mod="bold"}}},interaction:{zoomSpeed:.3},autoResize:!0,height:"100%",width:"100%",layout:{randomSeed:100,improvedLayout:!0,clusterThreshold:100,shakeTowards:"leaves"}}))},[d.graph,d.set]),f.exports.useEffect(()=>{!t.current||!d.highlight||t.current.selectNodes([d.highlight])},[d.highlight,d.graph]),c(C,{height:"100%",children:c(C,{height:"100%",ref:e})})}class Ne{constructor(e){F(this,"data");F(this,"adjacent");this.data=e,this.adjacent=[]}addAdjacent(e,t){this.adjacent.push([e,t])}removeAdjacent(e){const t=this.adjacent.findIndex(([n])=>n.data.id===e.id);return t>-1?this.adjacent.splice(t,1)[0][0]:null}}class R{constructor(){F(this,"nodes",new Map)}addNode(e){let t=this.nodes.get(e);return t||(t=new Ne(e),this.nodes.set(e,t),t)}removeNode(e){const t=this.nodes.get(e);return t?(this.nodes.forEach(n=>{n.removeAdjacent(t.data)}),this.nodes.delete(e),t):null}getNodeById(e){return Array.from(this.nodes.values()).find(t=>t.data.id===e)}addEdge(e,t,n){const s=this.addNode(e),i=this.addNode(t);s.addAdjacent(i,n)}addEdgeById(e,t,n){const s=this.getNodeById(e),i=this.getNodeById(t);!s||!i||this.addEdge(s.data,i.data,n)}removeEdge(e,t){const n=this.nodes.get(e),s=this.nodes.get(t);n&&s&&n.removeAdjacent(t)}successors(e){let t=null;for(const[,n]of this.nodes)n.data.id===e.id&&(t=n);return t===null?new Set:new Set(t.adjacent.map(([n])=>n))}predecessors(e){const t=new Set;for(const[,n]of this.nodes)for(const[s]of n.adjacent)s.data.id===e.id&&t.add(n);return t}}function B(d){return d.start+"-"+d.end}function be(d){let e;try{e=se(d,{ecmaVersion:2020})}catch{return new R}let t,n,s;try{[t,n,s]=oe(e)}catch{return new R}if(s[s.length-1]!==n){const r=s[s.length-1],o=s.findIndex(a=>a===n);s[o]=r,s[s.length-1]=n}const i=new R;return s.forEach((r,o)=>{var a,l,h,u,p,g;if(r===t){i.addNode({id:"ENTRY",index:o,prev:(a=r.prev)!=null?a:[],next:(l=r.next)!=null?l:[],type:"entry"});return}if(r===n){i.addNode({id:"EXIT",index:o,prev:(h=r.prev)!=null?h:[],next:(u=r.next)!=null?u:[],type:"exit"});return}i.addNode({id:B(r.astNode),index:o,type:"normal",astNode:r.astNode,prev:(p=r.prev)!=null?p:[],next:(g=r.next)!=null?g:[],true:r.true,false:r.false,exception:r.exception})}),s.forEach((r,o)=>{[r.normal,r.true,r.false].filter(a=>!!a).forEach(a=>{i.addEdgeById(r!==t?B(r.astNode):"ENTRY",a.astNode?B(a.astNode):"EXIT",a===r.normal?"":a===r.true?"True":a===r.false?"False":"Unknown")})}),i}const Se=(d,e,t)=>{let n={};for(const i of e)n[i.data.id]=t.universal;return n[t.entry.data.id]=[t.entry.data.id],t.fixedPoint(n,(i,r)=>{const o=[...d.predecessors(i.data)].map(a=>r[a.data.id]);return v.exports.union([i.data.id],v.exports.intersection(...o))}).map(i=>{const r=new Map;for(const[o,a]of Object.entries(i)){const l=d.getNodeById(o);!l||(a.length===e.length?r.set(l.data.id,"N"):r.set(l.data.id,`{${a.map(h=>{var u;return(u=d.getNodeById(h))==null?void 0:u.data.index}).sort().join(",")}}`))}return r})},ke=(d,e,t)=>{const n={};for(const o of e)n[o.data.id]=[],!(o.data.type==="entry"||o.data.type==="exit")&&W(o.data.astNode,(a,l,h)=>{switch(a.type){case"VariableDeclarator":{const u=v.exports.get(a,"id.name");u&&n[o.data.id].push(u)}case"AssignmentExpression":{const u=v.exports.get(a,"left.name");u&&n[o.data.id].push(u)}}});const s={};for(const o of e)s[o.data.id]=[],!(o.data.type==="entry"||o.data.type==="exit")&&(W(o.data.astNode,(a,l,h)=>{switch(a.type){case"Identifier":{const u=v.exports.get(a,"name");u&&s[o.data.id].push(u)}}}),s[o.data.id]=v.exports.difference(s[o.data.id],n[o.data.id]));let i={};for(const o of e)i[o.data.id]=[];return t.fixedPoint(i,(o,a)=>{let l=[];const h=d.successors(o.data);for(const u of h)l=v.exports.union(l,v.exports.union(s[u.data.id],v.exports.difference(a[u.data.id],n[u.data.id])));return l}).map(o=>{const a=new Map;for(const[l,h]of Object.entries(o))a.set(l,"{"+h.join(", ")+"}");return a})};function je(d,e,t){let n=e;const s=n.find(a=>a.data.type==="entry"),i=n.find(a=>a.data.type==="exit"),r=n.map(a=>a.data.id);if(!s||!i)return console.warn("Error: entry or exit is not in the graph!"),[];const o={entry:s,exit:i,universal:r,fixedPoint(a,l){const h=[a];let u=!0,p=a;for(;u;){const g=v.exports.cloneDeep(p);for(const N of n)g[N.data.id]=l(N,g);u=!v.exports.isEqual(p,g),p=g,h.push(p)}return h}};switch(t){case"Dominator":return Se(d,n,o);case"LiveOut":return ke(d,n,o)}return[]}function Z(d,e){let t=[...d.nodes.values()];switch(e){case"Default":break;case"Reversed":t=v.exports.reverse(t);break;case"PostOrder":t=P(d,t[0]);break;case"Reverse Post-Order":t=v.exports.reverse(P(d,t[0]));break;case"Reverse Post-Order on Reverse CFG":{const n=Me(d),s=t[t.length-1];t=v.exports.reverse(P(n,s));break}}return t}function P(d,e){if(!e)return[];const t=new Set,n=[];function s(i){t.add(i.data.id);const r=d.successors(i.data);for(const o of r)t.has(o.data.id)||s(o);n.push(i)}return s(e),n}function Me(d){const e=new R,t=[...d.nodes.values()];for(const n of t)e.addNode(n.data);for(const n of t)for(const[s,i]of n.adjacent)e.addEdgeById(s.data.id,n.data.id,i);return e}function Ee(){var G,L;const[d,e]=f.exports.useState("Default"),[t,n]=f.exports.useState("Dominator"),[s,i]=f.exports.useState(""),r=K(),o=K(),a=f.exports.useMemo(()=>be(s),[s]),l=f.exports.useMemo(()=>Z(a,"Default"),[a]),h=f.exports.useMemo(()=>Z(a,d),[a,d]),u=f.exports.useMemo(()=>l.length,[l]),p=f.exports.useMemo(()=>je(a,h,t),[a,t,h]),[g,N]=f.exports.useState(0),T=f.exports.useMemo(()=>l.length,[l]),E=f.exports.useMemo(()=>p.length*l.length,[p,l]),b=f.exports.useMemo(()=>Math.floor(g/u),[g,u]),M=f.exports.useMemo(()=>g%u,[g,u]),z=f.exports.useMemo(()=>p.filter((m,x)=>x<b),[p,b]),D=f.exports.useMemo(()=>{var I,O;const m=p[b-1],x=p[b],S=new Map;for(const[A,k]of h.entries())A<=M?S.set(k.data.id,(I=x==null?void 0:x.get(k.data.id))!=null?I:""):S.set(k.data.id,(O=m==null?void 0:m.get(k.data.id))!=null?O:"");return S},[b,p,M,h]);return f.exports.useEffect(()=>{N(E-1)},[E]),y(w,{height:"100%",direction:"column",children:[c(ve,{order:d,onOrderChange:e,mode:t,onModeChange:n}),y(w,{flex:"1",children:[c(C,{flex:"1",flexBasis:"400px",flexGrow:0,flexShrink:0,children:c(ye,{value:s,onChange:i})}),c(w,{flex:"2",direction:"column",flexGrow:0,minWidth:0,position:"relative",children:y(X,{handle:o,children:[c(w,{alignItems:"center",position:"absolute",top:2,left:2,right:2,zIndex:100,children:y(ae,{width:"100%",children:[y(de,{children:[c(j,{onClick:()=>N(T),children:"<<"}),c(j,{onClick:()=>N(m=>Math.max(T,m-1)),children:"<"}),y(j,{children:[g+1-T,"/",E-T]}),c(j,{onClick:()=>N(m=>Math.min(m+1,E-1)),children:">"}),c(j,{onClick:()=>N(E-1),children:">>"})]}),c(H,{}),c(ie,{children:"Full Screen: "}),c(j,{onClick:()=>r.enter(),children:"Graph"}),c(j,{onClick:()=>o.enter(),children:"Graph + Table"})]})}),y(w,{direction:"column",flex:"1",height:"100%",children:[c(C,{flex:"1",children:c(X,{handle:r,children:c(we,{graph:a,set:D,highlight:(L=(G=h[M])==null?void 0:G.data.id)!=null?L:""})})}),c(C,{children:y(ce,{children:[c(le,{children:y(Y,{children:[c(J,{children:"#"}),h.map(m=>c(J,{children:m.data.index},m.data.id))]})}),c(ue,{children:f.exports.useMemo(()=>[...z,D].map((m,x)=>y(Y,{children:[c(Q,{children:x===0?"Init":x}),h.map((S,I)=>{var A,k;const O=x>0&&m.get(S.data.id)!==((A=p[x-1])==null?void 0:A.get(S.data.id));return c(Q,{fontWeight:O?600:void 0,color:O?"red.400":void 0,backgroundColor:b===x&&M===I?"green.100":void 0,children:x===b&&I>M?"":(k=m.get(S.data.id))!=null?k:""},x+S.data.id)})]},x)),[z,D,h,g,b,M])})]})})]})]})})]})]})}he.render(c(fe.StrictMode,{children:c(pe,{children:c(Ee,{})})}),document.getElementById("root"));
